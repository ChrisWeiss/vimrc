#!/usr/bin/env ruby

# Generates features list in markdown based on vim file
#
# Usage:
#   bin/docs < plugins/sensible.vim

paragraphs = $stdin.readlines.chunk { |line| line.strip.length == 0 }.map(&:last) 

paragraphs.select! do |paragraph|
  paragraph.any?{ |line| line.strip[0] == '"' }
  paragraph.last.strip[0] != '"'
end

paragraphs.map! do |paragraph|
  {
    comments:
      paragraph.flat_map do |line|
        line[2..-1].strip if line && line.strip[0] == '"'
      end.select{ |line| line && line.strip.size > 0 },
    source:
      paragraph.select do |line|
        line && line.strip[0] != '"' && line.strip.size > 0
      end
  }
end.reject! do |paragraph|
  paragraph[:comments].empty? || paragraph[:source].empty?
end

paragraphs.map! do |paragraph|
  "* #{paragraph[:comments].join("\n  ")}\n  \`\`\`vim\n  #{paragraph[:source].join("  ")}  \`\`\`\n"
end

puts paragraphs.join("\n")
